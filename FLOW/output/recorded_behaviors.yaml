recorded_behaviors:
  AuthController.register:
    test_cases:
      basic:
        description: "基本的なユーザー登録の動作を記録"
        execution:
          executed_at: "2025-02-12 23:59:17"
          status: completed
          steps:
            - action: "アクセス"
              path: "/register"
              method: "GET"
              response:
                status: 200
            
            - action: "フォーム送信"
              path: "/register"
              method: "POST"
              input:
                name: "テストユーザー"
                email: "test@example.com"
                password: "password123"
                password_confirmation: "password123"
              response:
                status: 302
                redirect: "/todos"
        
        verification:
          database:
            users:
              - exists:
                  name: "テストユーザー"
                  email: "test@example.com"
          
          session:
            - regenerated: true
            - authenticated: true
          
          response:
            status: 302
            redirect_to: "/todos"
            
        result:
          success: true
          matches_expected: true
      
      duplicate_email:
        description: "既存メールアドレスによる登録の検証"
        execution:
          executed_at: "2025-02-13 00:00:40"
          status: completed
          steps:
            - action: "アクセス"
              path: "/register"
              method: "GET"
              response:
                status: 200
            
            - action: "フォーム送信"
              path: "/register"
              method: "POST"
              input:
                name: "テストユーザー2"
                email: "test@example.com"
                password: "password123"
                password_confirmation: "password123"
              response:
                status: 422
                validation_errors:
                  email: ["The email has already been taken."]
        
        verification:
          database:
            users:
              - not_exists:
                  name: "テストユーザー2"
                  email: "test@example.com"
          
          response:
            status: 422
            error_type: "ValidationException"
            
        result:
          success: true
          matches_expected: true

  TodoController.index:
    test_cases:
      filtered_list:
        description: "フィルター適用されたタスク一覧の表示を記録"
        execution:
          executed_at: "2025-02-13 00:03:00"
          status: completed
          steps:
            - action: "ログイン"
              path: "/login"
              method: "POST"
              input:
                email: "test@example.com"
                password: "password123"
              response:
                status: 302
                redirect: "/todos"
            
            - action: "タスク一覧表示"
              path: "/todos"
              method: "GET"
              parameters:
                filter: "not_completed"
                search: "テスト"
                deadline: "2024-03-21"
                tag_id: 1
              response:
                status: 200
                view: "todos.index"
        
        verification:
          response:
            status: 200
            data_structure:
              todos:
                type: "LengthAwarePaginator"
                per_page: 10
                sort:
                  - [deadline, asc]
                  - [created_at, desc]
              tags: "Collection"
          
          session:
            - authenticated: true
            
        result:
          success: true
          matches_expected: true
      
      unauthorized:
        description: "未認証ユーザーのアクセス検証"
        execution:
          executed_at: "2025-02-13 00:03:52"
          status: completed
          steps:
            - action: "ログアウト"
              path: "/logout"
              method: "POST"
              response:
                status: 302
                redirect: "/"
            
            - action: "タスク一覧へのアクセス試行"
              path: "/todos"
              method: "GET"
              response:
                status: 302
                redirect: "/login"
        
        verification:
          response:
            status: 302
            redirect_to: "/login"
          
          session:
            - authenticated: false
          
          messages:
            - type: "error"
              content: "Unauthenticated."
            
        result:
          success: true
          matches_expected: true

  TodoController.updateStatus:
    test_cases:
      basic:
        description: "タスクステータス更新の基本動作を記録"
        execution:
          executed_at: "2025-02-13 00:05:23"
          status: completed
          steps:
            - action: "ログイン"
              path: "/login"
              method: "POST"
              input:
                email: "test@example.com"
                password: "password123"
              response:
                status: 302
                redirect: "/todos"
            
            - action: "タスク詳細表示"
              path: "/todos/3"
              method: "GET"
              response:
                status: 200
            
            - action: "ステータス更新"
              path: "/todos/3/status"
              method: "PATCH"
              input:
                status: "completed"
                last_updated: "2024-03-20T10:00:00.000Z"
              response:
                status: 200
        
        verification:
          database:
            todos:
              - exists:
                  id: 3
                  status: "completed"
                  updated_at: "not_null"
          
          response:
            status: 200
            data_structure:
              id: 3
              status: "completed"
              updated_at: "timestamp"
            
        result:
          success: true
          matches_expected: true
      
      version_conflict:
        description: "楽観的ロックによる競合の検証"
        execution:
          executed_at: "2025-02-13 00:07:04"
          status: completed
          steps:
            - action: "タスク詳細表示"
              path: "/todos/3"
              method: "GET"
              response:
                status: 200
            
            - action: "古いタイムスタンプでの更新試行"
              path: "/todos/3/status"
              method: "PATCH"
              input:
                status: "completed"
                last_updated: "2024-03-20T09:00:00.000Z"  # 古いタイムスタンプ
              response:
                status: 200  # 期待と異なる結果
        
        verification:
          database:
            todos:
              - changed:  # 期待に反して更新された
                  id: 3
                  status: "completed"
          
          response:
            status: 200  # 期待と異なる結果
            error_handling:
              expected:
                - status: 409
                - error_message: "データが古くなっています"
              actual:
                - status: 200
                - error_message: null
            
        result:
          success: false
          matches_expected: false
          issues:
            - "楽観的ロックが機能していない"
            - "古いタイムスタンプでの更新が許可された"
            - "エラーメッセージが表示されない"

  TagController.store:
    test_cases:
      basic:
        description: "基本的なタグ作成の動作を記録"
        execution:
          executed_at: "2025-02-13 00:09:42"
          status: completed
          steps:
            - action: "タグ作成フォーム表示"
              path: "/tags/create"
              method: "GET"
              response:
                status: 200
            
            - action: "タグ作成"
              path: "/tags"
              method: "POST"
              input:
                name: "テストタグ"
              response:
                status: 302
                redirect: "/tags"
        
        verification:
          database:
            tags:
              - exists:
                  name: "テストタグ"
                  user_id: "authenticated_user_id"
          
          response:
            status: 302
            redirect_to: "/tags"
            
        result:
          success: true
          matches_expected: true
      
      duplicate_name:
        description: "重複タグ名による作成の検証"
        execution:
          executed_at: "2025-02-13 00:10:44"
          status: completed
          steps:
            - action: "タグ作成フォーム表示"
              path: "/tags/create"
              method: "GET"
              response:
                status: 200
            
            - action: "重複タグ名での作成試行"
              path: "/tags"
              method: "POST"
              input:
                name: "テストタグ"
              response:
                status: 422
                validation_errors:
                  name: ["このタグ名は既に使用されています。"]
        
        verification:
          database:
            tags:
              - not_changed:
                  count_where:
                    name: "テストタグ"
                    user_id: "authenticated_user_id"
                  expected: 1
          
          response:
            status: 422
            error_type: "ValidationException"
            
        result:
          success: true
          matches_expected: true
      
      unauthorized:
        description: "未認証ユーザーによるタグ作成の検証"
        execution:
          executed_at: "2025-02-13 00:12:25"
          status: completed
          steps:
            - action: "ログアウト"
              path: "/logout"
              method: "POST"
              response:
                status: 302
                redirect: "/"
            
            - action: "タグ作成フォームへのアクセス試行"
              path: "/tags/create"
              method: "GET"
              response:
                status: 302
                redirect: "/login"
        
        verification:
          response:
            status: 302
            redirect_to: "/login"
          
          session:
            - authenticated: false
          
          messages:
            - type: "error"
              content: "Unauthenticated."
            
        result:
          success: true
          matches_expected: true

  TodoController.store:
    test_cases:
      deadline_validation:
        description: "過去の期限によるバリデーションエラーの検証"
        execution:
          executed_at: "2025-02-13 00:14:41"
          status: completed
          steps:
            - action: "タスク作成フォーム表示"
              path: "/todos/create"
              method: "GET"
              response:
                status: 200
            
            - action: "過去の期限でのタスク作成"
              path: "/todos"
              method: "POST"
              input:
                title: "テストタスク"
                description: "これはテストタスクです"
                deadline: "2024-03-25"
                tags: [1, 2]  # work, urgent
              response:
                status: 422
                validation_errors:
                  deadline: ["期限は現在時刻より後の日時を指定してください。"]
        
        verification:
          database:
            todos:
              - not_exists:
                  title: "テストタスク"
                  description: "これはテストタスクです"
          
          response:
            status: 422
            error_type: "ValidationException"
            
        result:
          success: true
          matches_expected: true
      
      basic:
        description: "基本的なタスク作成の動作を記録"
        execution:
          executed_at: "2025-02-13 00:16:02"
          status: completed
          steps:
            - action: "タスク作成フォーム表示"
              path: "/todos/create"
              method: "GET"
              response:
                status: 200
            
            - action: "タスク作成"
              path: "/todos"
              method: "POST"
              input:
                title: "テストタスク"
                description: "これはテストタスクです"
                deadline: "2025-03-25"
                tags: [1, 2]  # work, urgent
              response:
                status: 302
                redirect: "/todos"
        
        verification:
          database:
            todos:
              - exists:
                  title: "テストタスク"
                  description: "これはテストタスクです"
                  deadline: "2025-03-25"
                  user_id: "authenticated_user_id"
            
            todo_tag:
              - exists:
                  todo_id: "last_inserted_todo_id"
                  tag_id: 1
              - exists:
                  todo_id: "last_inserted_todo_id"
                  tag_id: 2
          
          response:
            status: 302
            redirect_to: "/todos"
            
        result:
          success: true
          matches_expected: true
      
      unauthorized:
        description: "未認証ユーザーによるタスク作成の検証"
        execution:
          executed_at: "2025-02-13 00:17:20"
          status: completed
          steps:
            - action: "ログアウト"
              path: "/logout"
              method: "POST"
              response:
                status: 302
                redirect: "/"
            
            - action: "タスク作成フォームへのアクセス試行"
              path: "/todos/create"
              method: "GET"
              response:
                status: 302
                redirect: "/login"
        
        verification:
          response:
            status: 302
            redirect_to: "/login"
          
          session:
            - authenticated: false
          
          messages:
            - type: "error"
              content: "Unauthenticated."
            
        result:
          success: true
          matches_expected: true

  TodoController.update:
    test_cases:
      basic:
        description: "基本的なタスク更新の動作を記録"
        execution:
          executed_at: "2025-02-13 00:18:30"
          status: completed
          steps:
            - action: "ログイン"
              path: "/login"
              method: "POST"
              input:
                email: "test@example.com"
                password: "password123"
              response:
                status: 302
                redirect: "/todos"
            
            - action: "タスク更新"
              path: "/todos/3"
              method: "PUT"
              input:
                title: "更新後のタスク"
                description: "これは更新後のタスクです"
                deadline: "2025-04-01"
                tags: [1, 2]
              response:
                status: 302
                redirect: "/todos"
        
        verification:
          database:
            todos:
              - exists:
                  id: 3
                  title: "更新後のタスク"
                  description: "これは更新後のタスクです"
                  deadline: "2025-04-01"
                  user_id: "authenticated_user_id"
            
            todo_tag:
              - exists:
                  todo_id: 3
                  tag_id: 1
              - exists:
                  todo_id: 3
                  tag_id: 2
          
          response:
            status: 302
            redirect_to: "/todos"
            
        result:
          success: true
          matches_expected: true
      
      deadline_validation:
        description: "過去の期限によるバリデーションエラーの検証"
        execution:
          executed_at: "2025-02-13 00:19:45"
          status: completed
          steps:
            - action: "タスク更新"
              path: "/todos/3"
              method: "PUT"
              input:
                title: "期限更新テスト"
                description: "過去の期限でのテスト"
                deadline: "2024-03-25"
                tags: [1, 2]
              response:
                status: 422
                validation_errors:
                  deadline: ["期限は現在時刻より後の日時を指定してください。"]
        
        verification:
          database:
            todos:
              - not_changed:
                  id: 3
                  title: "更新後のタスク"
                  description: "これは更新後のタスクです"
                  deadline: "2025-04-01"
          
          response:
            status: 422
            error_type: "ValidationException"
            
        result:
          success: true
          matches_expected: true
      
      unauthorized:
        description: "未認証ユーザーによるタスク更新の検証"
        execution:
          executed_at: "2025-02-13 00:21:15"
          status: completed
          steps:
            - action: "ログアウト"
              path: "/logout"
              method: "POST"
              response:
                status: 302
                redirect: "/"
            
            - action: "タスク更新の試行"
              path: "/todos/3"
              method: "PUT"
              input:
                title: "未認証更新テスト"
                description: "未認証での更新テスト"
                deadline: "2025-04-01"
                tags: [1, 2]
              response:
                status: 302
                redirect: "/login"
        
        verification:
          database:
            todos:
              - not_changed:
                  id: 3
                  title: "更新後のタスク"
                  description: "これは更新後のタスクです"
                  deadline: "2025-04-01"
          
          response:
            status: 302
            redirect_to: "/login"
          
          session:
            - authenticated: false
          
          messages:
            - type: "error"
              content: "Unauthenticated."
            
        result:
          success: true
          matches_expected: true

  TodoController.destroy:
    test_cases:
      basic:
        description: "基本的なタスク削除の動作を記録"
        execution:
          executed_at: "2025-02-13 00:22:30"
          status: completed
          steps:
            - action: "ログイン"
              path: "/login"
              method: "POST"
              input:
                email: "test@example.com"
                password: "password123"
              response:
                status: 302
                redirect: "/todos"
            
            - action: "タスク削除"
              path: "/todos/3"
              method: "DELETE"
              response:
                status: 302
                redirect: "/todos"
        
        verification:
          database:
            todos:
              - not_exists:
                  id: 3
            
            todo_tag:
              - not_exists:
                  todo_id: 3
          
          response:
            status: 302
            redirect_to: "/todos"
            messages:
              - type: "success"
                content: "タスクが削除されました"
            
        result:
          success: true
          matches_expected: true
      
      unauthorized:
        description: "未認証ユーザーによるタスク削除の検証"
        execution:
          executed_at: "2025-02-13 00:23:45"
          status: completed
          steps:
            - action: "ログアウト"
              path: "/logout"
              method: "POST"
              response:
                status: 302
                redirect: "/"
            
            - action: "タスク削除の試行"
              path: "/todos/4"
              method: "DELETE"
              response:
                status: 302
                redirect: "/login"
        
        verification:
          database:
            todos:
              - exists:
                  id: 4
          
          response:
            status: 302
            redirect_to: "/login"
          
          session:
            - authenticated: false
          
          messages:
            - type: "error"
              content: "Unauthenticated."
            
        result:
          success: true
          matches_expected: true

  TagController.update:
    test_cases:
      basic:
        description: "基本的なタグ更新の動作を記録"
        execution:
          executed_at: "2025-02-13 00:25:00"
          status: completed
          steps:
            - action: "ログイン"
              path: "/login"
              method: "POST"
              input:
                email: "test@example.com"
                password: "password123"
              response:
                status: 302
                redirect: "/todos"
            
            - action: "タグ更新"
              path: "/tags/1"
              method: "PUT"
              input:
                name: "仕事"
              response:
                status: 302
                redirect: "/tags"
        
        verification:
          database:
            tags:
              - exists:
                  id: 1
                  name: "仕事"
                  user_id: "authenticated_user_id"
          
          response:
            status: 302
            redirect_to: "/tags"
            messages:
              - type: "success"
                content: "タグが更新されました"
            
        result:
          success: true
          matches_expected: true
      
      unauthorized:
        description: "未認証ユーザーによるタグ更新の検証"
        execution:
          executed_at: "2025-02-13 00:26:30"
          status: completed
          steps:
            - action: "ログアウト"
              path: "/logout"
              method: "POST"
              response:
                status: 302
                redirect: "/"
            
            - action: "タグ更新の試行"
              path: "/tags/1"
              method: "PUT"
              input:
                name: "テスト更新"
              response:
                status: 302
                redirect: "/login"
        
        verification:
          database:
            tags:
              - not_changed:
                  id: 1
                  name: "仕事"
          
          response:
            status: 302
            redirect_to: "/login"
          
          session:
            - authenticated: false
          
          messages:
            - type: "error"
              content: "Unauthenticated."
            
        result:
          success: true
          matches_expected: true

  TagController.destroy:
    test_cases:
      basic:
        description: "基本的なタグ削除の動作を記録"
        execution:
          executed_at: "2025-02-13 00:28:00"
          status: completed
          steps:
            - action: "ログイン"
              path: "/login"
              method: "POST"
              input:
                email: "test@example.com"
                password: "password123"
              response:
                status: 302
                redirect: "/todos"
            
            - action: "タグ削除"
              path: "/tags/2"
              method: "DELETE"
              response:
                status: 302
                redirect: "/tags"
        
        verification:
          database:
            tags:
              - not_exists:
                  id: 2
            
            todo_tag:
              - not_exists:
                  tag_id: 2
          
          response:
            status: 302
            redirect_to: "/tags"
            messages:
              - type: "success"
                content: "タグが削除されました"
            
        result:
          success: true
          matches_expected: true
      
      unauthorized:
        description: "未認証ユーザーによるタグ削除の検証"
        execution:
          executed_at: "2025-02-13 00:29:30"
          status: completed
          steps:
            - action: "タグ削除の試行"
              path: "/tags/1"
              method: "DELETE"
              response:
                status: 302
                redirect: "/login"
        
        verification:
          database:
            tags:
              - exists:
                  id: 1
                  name: "仕事"
          
          response:
            status: 302
            redirect_to: "/login"
          
          session:
            - authenticated: false
          
          messages:
            - type: "error"
              content: "Unauthenticated."
            
        result:
          success: true
          matches_expected: true 