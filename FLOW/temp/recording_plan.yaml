# 動作記録の計画：各メソッドについて記録すべき動作パターンを定義
recording_plan:
  AuthController.register:
    normal_patterns:
      basic:
        description: "基本的なユーザー登録の動作を記録"
        input_pattern:
          name: "テストユーザー"
          email: "test@example.com"
          password: "password123"
          password_confirmation: "password123"
        verify_state_changes:
          - target: database.users
            type: insert
            fields: [name, email, password]
          - target: session
            type: regenerate
        verify_output:
          - status: 302
          - redirect_to: todos.index

    error_patterns:
      duplicate_email:
        description: "既存メールアドレスによる登録の検証"
        input_pattern:
          name: "テストユーザー2"
          email: "test@example.com"  # 既に使用済みのメール
          password: "password123"
          password_confirmation: "password123"
        verify_output:
          - status: 422
          - validation_errors: [email]

  TodoController.index:
    normal_patterns:
      filtered_list:
        description: "フィルター適用されたタスク一覧の表示を記録"
        input_pattern:
          filter: "not_completed"
          search: "テスト"
          deadline: "2024-03-21"
          tag_id: 1
        verify_output:
          - status: 200
          - view: todos.index
          - data_structure:
              todos:
                type: LengthAwarePaginator
                per_page: 10
                sort:
                  - [deadline, asc]
                  - [created_at, desc]
              tags: Collection

    error_patterns:
      unauthorized:
        description: "未認証ユーザーのアクセス検証"
        verify_output:
          - status: 401
          - error_message: "Unauthenticated."

  TodoController.updateStatus:
    normal_patterns:
      basic:
        description: "タスクステータス更新の基本動作を記録"
        input_pattern: 
          status: "completed"
          last_updated: "2024-03-20T10:00:00.000Z"
        verify_state_changes:
          - target: database.todos
            type: update
            fields: [status, updated_at]
        verify_output:
          - status: 200
          - response_structure: [id, status, updated_at]

    error_patterns:
      version_conflict:
        description: "楽観的ロックによる競合の検証"
        input_pattern:
          status: "completed"
          last_updated: "2024-03-20T09:00:00.000Z"  # 古いタイムスタンプ
        verify_output:
          - status: 409
          - error_message: "データが古くなっています"

  TagController.store:
    normal_patterns:
      basic:
        description: "基本的なタグ作成の動作を記録"
        input_pattern:
          name: "テストタグ"
        verify_state_changes:
          - target: database.tags
            type: insert
            fields: [name, user_id]
        verify_output:
          - status: 302
          - redirect_to: configurable

    error_patterns:
      duplicate_name:
        description: "同一ユーザー内での重複タグ名の検証"
        input_pattern:
          name: "既存タグ"  # 既に存在するタグ名
        verify_output:
          - status: 422
          - validation_errors: [name]

  DashboardController.index:
    normal_patterns:
      with_data:
        description: "データが存在する場合のダッシュボード表示を記録"
        preconditions:
          - "複数のタスクが存在すること"
          - "異なるステータスのタスクが含まれること"
          - "タグが付与されたタスクが存在すること"
        verify_output:
          - status: 200
          - view: dashboard.index
          - data_structure:
              statistics:
                type: array
                fields: [total, in_progress, completed, overdue]
              progressChart:
                type: array
                fields: [labels, data, backgroundColor]
              tagStatistics:
                type: array
                fields: [name, count]
              upcomingDeadlines:
                type: Collection
                model: Todo
                limit: 5
              dailyTaskCreation:
                type: array
                fields: [labels, data]
                period: last_14_days

      no_data:
        description: "データが存在しない場合のダッシュボード表示を記録"
        preconditions:
          - "タスクが存在しないこと"
        verify_output:
          - status: 200
          - view: dashboard.index
          - empty_data_indicators: true 